<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Journ√©e Sans Nous ‚Äî G√©n√©rateur de mails aux syndicats</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
  <style>
    :root{--brand:#ee4943;--brand-600:#d33e38;--ink:#0f172a;--muted:#475569;--line:#e5e7eb;--radius:16px}
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.6 'Manrope',sans-serif;color:var(--ink);background:#fafafa}
    a{color:var(--brand);text-decoration:none}
    header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--line);box-shadow:0 1px 3px rgba(0,0,0,.05)}
    .wrap{max-width:1100px;margin:auto;padding:0 18px}
    .topbar{display:flex;justify-content:space-between;align-items:center;height:64px;flex-wrap:wrap;gap:10px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;color:var(--brand)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;color:var(--ink);cursor:pointer;font-family:inherit;font-size:14px;transition:all .2s;font-weight:600}
    .btn:hover{background:#f8f9fa;transform:translateY(-1px)}
    .btn.primary{background:var(--brand);border-color:var(--brand-600);color:#fff}
    .btn.primary:hover{background:var(--brand-600)}
    .btn.ghost{background:transparent;border-color:transparent}
    .btn.ghost:hover{background:#f8f9fa}
    .btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
    .btn i{font-size:14px}
    
    .ticker{background:var(--brand);color:#fff;overflow:hidden;white-space:nowrap}
    .ticker .track{display:inline-block;animation:scroll 60s linear infinite;padding:6px 0}
    @keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
    
    .hero{background:linear-gradient(180deg,#fff 0%,#fff5f4 100%);padding:30px 0;border-bottom:1px solid var(--line)}
    h1{color:var(--brand);font-size:clamp(28px,3.2vw,42px);line-height:1.2;margin:0}
    .lede{color:var(--muted);margin:.6rem 0 0;font-size:17px}
    
    /* Barre de progression */
    .progress-bar{background:#f1f5f9;height:8px;border-radius:999px;overflow:hidden;margin:20px 0}
    .progress-fill{background:linear-gradient(90deg,var(--brand),#ff6b6b);height:100%;transition:width .6s ease;border-radius:999px;position:relative}
    .progress-fill::after{content:'';position:absolute;top:0;right:0;bottom:0;width:30px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3));animation:shimmer 1.5s infinite}
    @keyframes shimmer{0%,100%{opacity:0}50%{opacity:1}}
    .progress-text{text-align:center;margin-top:8px;font-size:14px;font-weight:600;color:var(--brand)}
    
    main{max-width:900px;margin:auto;padding:24px 18px}
    
    .step-card{background:#fff;border:1px solid var(--line);border-radius:16px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,.04);transition:box-shadow .2s}
    .step-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.08)}
    .step-head{display:flex;justify-content:space-between;align-items:center;padding:18px 20px;border-bottom:1px solid var(--line);background:#fafafa;border-radius:16px 16px 0 0}
    .step-head h2{margin:0;color:var(--brand);font-size:18px;display:flex;align-items:center;gap:10px}
    .step-num{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;background:var(--brand);color:#fff;border-radius:50%;font-size:14px;font-weight:800}
    .step-body{padding:20px}
    
    .form-group{margin-bottom:18px}
    .form-group:last-child{margin-bottom:0}
    label{display:block;font-weight:600;margin-bottom:6px;color:var(--ink);font-size:14px;display:flex;align-items:center;gap:8px}
    .field-check{display:none;color:#10b981;font-size:16px}
    .field-check.show{display:inline-block;animation:checkPop .3s ease}
    @keyframes checkPop{0%{transform:scale(0)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
    .helper{color:var(--muted);font-size:13px;margin-top:4px;line-height:1.4}
    input,select,textarea{width:100%;padding:11px 13px;border:1px solid var(--line);border-radius:10px;background:#fff;outline:none;font-family:inherit;font-size:15px;transition:all .2s}
    input:focus,select:focus,textarea:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(238,73,67,.1)}
    textarea{min-height:280px;resize:vertical;font-size:14px;line-height:1.6}
    select{cursor:pointer}
    
    .grid-2{display:grid;gap:14px;grid-template-columns:1fr}
    @media(min-width:680px){.grid-2{grid-template-columns:1fr 1fr}}
    
    .checkbox-group{display:flex;align-items:center;gap:10px;padding:12px;background:#f8f9fa;border-radius:10px;cursor:pointer;transition:background .2s}
    .checkbox-group:hover{background:#f1f3f5}
    .checkbox-group input[type="checkbox"]{width:auto;margin:0;cursor:pointer}
    .checkbox-group label{margin:0;cursor:pointer;font-weight:500}
    
    #mandat-details{display:none;margin-top:10px}
    #mandat-details.show{display:block}
    
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    @media(max-width:680px){.actions{flex-direction:column}}
    
    .note{border-left:4px solid var(--brand);background:#fff2f1;padding:12px 14px;border-radius:10px;font-size:14px;line-height:1.5}
    .note strong{color:var(--brand)}
    
    .preview-box{white-space:pre-wrap;border:1px solid var(--line);border-radius:10px;padding:16px;background:#fafafa;font-size:14px;line-height:1.7;max-height:400px;overflow-y:auto;color:#334155}
    .preview-box.empty{color:var(--muted);font-style:italic;text-align:center;padding:40px 20px}
    
    .success-banner{background:#10b981;color:#fff;padding:12px 20px;border-radius:10px;display:none;align-items:center;gap:10px;margin-bottom:16px}
    .success-banner.show{display:flex}
    
    footer{color:#64748b;text-align:center;padding:26px 0;border-top:1px solid var(--line);margin-top:40px;background:#fff}
    
    @media(max-width:680px){
      .topbar{height:auto;padding:12px 0}
      .step-head{flex-direction:column;align-items:flex-start;gap:12px}
      .step-head .actions{width:100%}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap topbar">
      <div class="brand"><span>Journ√©e Sans Nous</span></div>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <a class="btn ghost" href="./index.html"><i class="fa-solid fa-arrow-left"></i> Retour</a>
      </div>
    </div>
  </header>

  <div class="ticker"><div class="track">EN R√âGION PARISIENNE : lundi 17 novembre 19h‚Äì21h ‚ûú Assembl√©e publique ‚Äì Bourse du Travail, 29 Bd du Temple, 75011 Paris ‚Ä¢ tous les lundis 19h ‚ûú R√©union d'organisation ‚Äì 3 rue du Ch√¢teau d'Eau ‚Ä¢ √Ä L'√âCHELLE NATIONALE : jeudi 30 octobre 19h‚Äì21h ‚ûú R√©union en visio nationale des collectifs signataires de l'appel ‚Ä¢ EN R√âGION PARISIENNE : lundi 17 novembre 19h‚Äì21h ‚ûú Assembl√©e publique ‚Äì Bourse du Travail, 29 Bd du Temple, 75011 Paris ‚Ä¢ tous les lundis 19h ‚ûú R√©union d'organisation ‚Äì 3 rue du Ch√¢teau d'Eau</div></div>

  <section class="hero">
    <div class="wrap">
      <h1>G√©n√©rateur de mails aux syndicats</h1>
      <p class="lede">Contacte ton syndicat en 3 √©tapes pour organiser la gr√®ve solidaire du 18 d√©cembre</p>
      
      <div class="progress-bar">
        <div class="progress-fill" id="progressBar" style="width:0%"></div>
      </div>
      <div class="progress-text" id="progressText">0% compl√©t√©</div>
    </div>
  </section>

  <main>
    <div>
      <!-- √âTAPE 1 -->
    <div class="step-card">
      <div class="step-head">
        <h2><span class="step-num">1</span> Choisis ton syndicat</h2>
      </div>
      <div class="step-body">
        <div class="grid-2">
          <div class="form-group">
            <label for="syndicat">Syndicat * <span class="field-check" id="check-syndicat">‚úì</span></label>
            <select id="syndicat" required>
              <option value="">‚Äî S√©lectionner ‚Äî</option>
            </select>
          </div>
          <div class="form-group">
            <label for="dept">D√©partement <span class="field-check" id="check-dept">‚úì</span></label>
            <select id="dept">
              <option value="">‚Äî Optionnel ‚Äî</option>
            </select>
            <div class="helper">Union D√©partementale de ton d√©partement</div>
          </div>
          <div class="form-group">
            <label for="fede">F√©d√©ration (secteur) <span class="field-check" id="check-fede">‚úì</span></label>
            <select id="fede">
              <option value="">‚Äî Optionnel ‚Äî</option>
            </select>
            <div class="helper">F√©d√©ration de ton secteur professionnel</div>
          </div>
          <div class="form-group">
           <!-- Champ email prot√©g√© contre l‚Äôautofill du navigateur -->
<!-- On ajoute un champ invisible pour "pi√©ger" l'autofill -->
<input type="email" name="fake_email" autocomplete="email"
       style="position:absolute;left:-9999px;opacity:0;width:0;height:0;border:0;padding:0"
       tabindex="-1" aria-hidden="true">

<label for="destinataire">Destinataire</label>
<input
  id="destinataire"
  name="destinataire_os"
  type="email"
  inputmode="email"
  placeholder="ex : contact@syndicat-xx.org"
  autocomplete="off"
  autocapitalize="off"
  spellcheck="false"
  style="flex:1"
/>
<div class="helper">Auto-rempli par la base (priorit√© F√©d√©ration ‚ûú UD ‚ûú National).</div>

          </div>
        </div>
        <div class="form-group" style="margin-top:10px">
          <label for="cc">Copie (CC - optionnel) <span class="field-check" id="check-cc">‚úì</span></label>
          <input id="cc" type="text" placeholder="Emails suppl√©mentaires en copie..." />
          <div class="helper">Les emails en surplus s'ajoutent ici automatiquement</div>
        </div>
      </div>
    </div>

    <!-- √âTAPE 2 -->
    <div class="step-card">
      <div class="step-head">
        <h2><span class="step-num">2</span> Tes informations</h2>
      </div>
      <div class="step-body">
        <div class="grid-2">
          <div class="form-group">
            <label for="nom">Nom / Pr√©nom * <span class="field-check" id="check-nom">‚úì</span></label>
            <input id="nom" placeholder="Ton nom ou collectif" required />
          </div>
          <div class="form-group">
            <label for="lieu">Ville / Lieu de travail * <span class="field-check" id="check-lieu">‚úì</span></label>
            <input id="lieu" placeholder="Paris 20e, entrep√¥t X..." required />
          </div>
        </div>
        
        <div class="form-group">
          <div class="checkbox-group" onclick="document.getElementById('hasMandat').click()">
            <input type="checkbox" id="hasMandat" onclick="event.stopPropagation()">
            <label for="hasMandat">J'ai un mandat syndical</label>
          </div>
          <div id="mandat-details">
            <input id="mandat" placeholder="Ex : d√©l√©gu√©¬∑e syndical¬∑e, √©lu¬∑e CSE..." style="margin-top:10px" />
            <div class="helper">Pr√©cise ton mandat pour renforcer ta l√©gitimit√©</div>
          </div>
        </div>

        <div class="form-group">
          <label for="sujet">Objet de l'email <span class="field-check" id="check-sujet">‚úì</span></label>
          <input id="sujet" value="Appel √† la mobilisation du 18 d√©cembre ‚Äì Journ√©e Sans Nous : pour une gr√®ve solidaire et politique" />
        </div>
      </div>
    </div>

    <!-- √âTAPE 3 -->
    <div class="step-card">
      <div class="step-head">
        <h2><span class="step-num">3</span> Personnaliser le message</h2>
      </div>
      <div class="step-body">
        <div class="form-group">
          <label for="message">Corps du message (modifiable si besoin)</label>
          <textarea id="message" placeholder="Le message se g√©n√®re automatiquement avec tes informations..."></textarea>
        </div>
        <div class="note">
          <strong>üí° Le message se remplit automatiquement</strong> avec tes informations. Tu peux le modifier directement dans la zone de texte si tu veux le personnaliser davantage.
        </div>
      </div>
    </div>

    <!-- √âTAPE 4 -->
    <div class="step-card">
      <div class="step-head">
        <h2><span class="step-num">4</span> V√©rifier et envoyer</h2>
      </div>
      <div class="step-body">
        <div class="form-group">
          <label>Aper√ßu du message</label>
          <div id="preview" class="preview-box empty">Charge le mod√®le pour voir l'aper√ßu...</div>
        </div>
        
        <div class="actions" style="margin-top:16px">
          <button class="btn primary" id="btnMailto"><i class="fa-solid fa-paper-plane"></i> Ouvrir dans mon mail</button>
          <button class="btn" id="btnCopier"><i class="fa-solid fa-copy"></i> Copier le message</button>
          <button class="btn" id="btnTelecharger"><i class="fa-solid fa-file-arrow-down"></i> T√©l√©charger (.txt)</button>
        </div>
        
        <div class="note" style="margin-top:12px">
          <strong>üìß Comment envoyer :</strong><br>
          ‚Ä¢ <strong>"Ouvrir dans mon logiciel mail"</strong> : ouvre automatiquement ton application mail (Gmail, Outlook, etc.) avec tout pr√©-rempli<br>
          ‚Ä¢ <strong>"Copier le message"</strong> : copie juste le texte pour le coller o√π tu veux<br>
          ‚Ä¢ <strong>"T√©l√©charger"</strong> : sauvegarde le message en fichier texte
        </div>
      </div>
    </div>
  </main>

  <footer><div class="wrap">¬© Journ√©e Sans Nous ‚Äî G√©n√©rateur de mails</div></footer>

<script>
/* ===== Helpers & progression ===== */
const el = id => document.getElementById(id);

function updateProgress(){
  const fields = {
    'syndicat': el('syndicat').value,
    'destinataire': el('destinataire').value,
    'nom': el('nom').value,
    'lieu': el('lieu').value,
    'sujet': el('sujet').value,
    'message': el('message').value
  };
  let completed = 0, total = Object.keys(fields).length;
  Object.keys(fields).forEach(key => {
    const filled = fields[key] && fields[key].trim();
    const check = document.getElementById(`check-${key}`);
    if (check) check.classList.toggle('show', !!filled);
    if (filled) completed++;
  });
  ['dept','fede','cc'].forEach(key=>{
    const v = el(key).value||'';
    const check = document.getElementById(`check-${key}`);
    if (check) check.classList.toggle('show', !!v.trim());
  });
  const pct = Math.round((completed/total)*100);
  el('progressBar').style.width = pct+'%';
  el('progressText').textContent = pct+'% compl√©t√©';
}

/* ===== Mapping d√©partements ===== */
const DEPTS={"01":"Ain","02":"Aisne","03":"Allier","04":"Alpes-de-Haute-Provence","05":"Hautes-Alpes","06":"Alpes-Maritimes","07":"Ard√®che","08":"Ardennes","09":"Ari√®ge","10":"Aube","11":"Aude","12":"Aveyron","13":"Bouches-du-Rh√¥ne","14":"Calvados","15":"Cantal","16":"Charente","17":"Charente-Maritime","18":"Cher","19":"Corr√®ze","2A":"Corse-du-Sud","2B":"Haute-Corse","21":"C√¥te-d'Or","22":"C√¥tes-d'Armor","23":"Creuse","24":"Dordogne","25":"Doubs","26":"Dr√¥me","27":"Eure","28":"Eure-et-Loir","29":"Finist√®re","30":"Gard","31":"Haute-Garonne","32":"Gers","33":"Gironde","34":"H√©rault","35":"Ille-et-Vilaine","36":"Indre","37":"Indre-et-Loire","38":"Is√®re","39":"Jura","40":"Landes","41":"Loir-et-Cher","42":"Loire","43":"Haute-Loire","44":"Loire-Atlantique","45":"Loiret","46":"Lot","47":"Lot-et-Garonne","48":"Loz√®re","49":"Maine-et-Loire","50":"Manche","51":"Marne","52":"Haute-Marne","53":"Mayenne","54":"Meurthe-et-Moselle","55":"Meuse","56":"Morbihan","57":"Moselle","58":"Ni√®vre","59":"Nord","60":"Oise","61":"Orne","62":"Pas-de-Calais","63":"Puy-de-D√¥me","64":"Pyr√©n√©es-Atlantiques","65":"Hautes-Pyr√©n√©es","66":"Pyr√©n√©es-Orientales","67":"Bas-Rhin","68":"Haut-Rhin","69":"Rh√¥ne","70":"Haute-Sa√¥ne","71":"Sa√¥ne-et-Loire","72":"Sarthe","73":"Savoie","74":"Haute-Savoie","75":"Paris","76":"Seine-Maritime","77":"Seine-et-Marne","78":"Yvelines","79":"Deux-S√®vres","80":"Somme","81":"Tarn","82":"Tarn-et-Garonne","83":"Var","84":"Vaucluse","85":"Vend√©e","86":"Vienne","87":"Haute-Vienne","88":"Vosges","89":"Yonne","90":"Territoire de Belfort","91":"Essonne","92":"Hauts-de-Seine","93":"Seine-Saint-Denis","94":"Val-de-Marne","95":"Val-d'Oise","971":"Guadeloupe","972":"Martinique","973":"Guyane","974":"La R√©union","975":"Saint-Pierre-et-Miquelon","976":"Mayotte","977":"Saint-Barth√©lemy","978":"Saint-Martin","986":"Wallis-et-Futuna","987":"Polyn√©sie fran√ßaise","988":"Nouvelle-Cal√©donie"};

/* ===== Base emails (sera remplac√©e par le JSON charg√©) ===== */
let DB={
  "CFDT": {"national": "paris@sgen.cfdt.fr", "ud": [], "fede": []},
  "CFTC": {"national": "organisation@cftc.fr", "ud": [], "fede": []},
  "Solidaires": {"national": "contact@solidaires.org", "ud": [], "fede": []},
  "CGT-FO": {"national": "secretariatnego@force-ouvriere.fr", "ud": [], "fede": []},
  "CFE-CGC": {"national": "pap@cfecgc.fr", "ud": [], "fede": []},
  "CGT": {"national": "site@cgt.org", "ud": [], "fede": []},
  "UNSA": {"national": null, "ud": [], "fede": []}
};

/* ===== Chargement JSON ===== */
async function loadDB(){
  const urls = [
    'data/emails-syndicats.json',
    './data/emails-syndicats.json',
    '../data/emails-syndicats.json',
    '/journeesansnous/data/emails-syndicats.json',
    'https://mijnschatje.github.io/journeesansnous/data/emails-syndicats.json'
  ];
  for (const url of urls){
    try{
      const r = await fetch(url, {cache:'no-store'});
      if (r.ok){
        DB = await r.json();
        break;
      }
    }catch(e){}
  }
  fillSyndicats();
}

/* ===== Remplissage listes ===== */
function fillSyndicats(){
  const s = el('syndicat');
  s.innerHTML = '<option value="">‚Äî S√©lectionner ‚Äî</option>';
  Object.keys(DB).sort().forEach(k=> s.add(new Option(k,k)));
  fillStructures();
  updateProgress();
}

function udSortKey(x){
  const c=(x.code||'').toUpperCase();
  const m=c.match(/^(\d+)([A-Z]?)$/);
  if(!m) return [9999,c];
  const n=parseInt(m[1],10);
  const frac = m[2]==='A'?0.1:(m[2]==='B'?0.2:0);
  return [n+frac,c];
}

function fillStructures(){
  const synd = el('syndicat').value;
  const dept = el('dept');
  const fede = el('fede');
  dept.innerHTML = '<option value="">‚Äî Optionnel ‚Äî</option>';
  fede.innerHTML = '<option value="">‚Äî Optionnel ‚Äî</option>';

  if (!synd){ updateEmail(); updateProgress(); return; }

  const rec = DB[synd] || {};
  (rec.fede||[]).forEach(x => {
    fede.add(new Option(x.label || 'F√©d√©ration', x.email || ''));
  });

  const sortedUDs = (rec.ud||[]).slice().sort((a,b)=>{
    const [an,ac]=udSortKey(a), [bn,bc]=udSortKey(b);
    return an-bn || ac.localeCompare(bc);
  });
  sortedUDs.forEach(x=>{
    const code=x.code||''; const email=x.email||'';
    const nice = (code && DEPTS[code]) ? `${code} ‚Äì ${DEPTS[code]}` : (x.label || code || 'UD');
    dept.add(new Option(nice, email));
  });

  updateEmail();
  updateProgress();
}

/* ===== Choix email auto: priorit√© F√©d√© ‚Üí UD ‚Üí National ===== */
function updateEmail(){
  const synd = el('syndicat').value;
  const fedeVal = el('fede').value || '';
  const deptVal = el('dept').value || '';
  const national = (DB[synd]||{}).national || '';

  // Priorit√©: F√©d√© ‚Üí UD ‚Üí National
  const ordered = [fedeVal, deptVal, national].filter(Boolean);

  if (ordered.length){
    el('destinataire').value = ordered[0];
    el('cc').value = ordered.slice(1).join(', ');
  }else{
    el('destinataire').value = '';
    el('cc').value = '';
  }
  updateProgress();
}

/* ===== G√©n√©ration du mod√®le ===== */
function MODELE_OFFICIEL(){
  const nom=(el('nom').value||'').trim() || '[Pr√©nom Nom]';
  const lieu=(el('lieu').value||'').trim() || '[Ville / Lieu de travail / √âtablissement]';
  const hasMandat=el('hasMandat').checked;
  const mandat=hasMandat ? (el('mandat').value||'').trim() : '';
  const phraseMobilisation = (hasMandat && mandat)
    ? `En tant que ${mandat}, je souhaite que mon lieu de travail puisse se joindre √† cette mobilisation historique.`
    : `Je souhaite que mon lieu de travail puisse se joindre √† cette mobilisation historique.`;
  let signature = `${nom}\n${lieu}`;
  if (hasMandat && mandat) signature += `\nMandat : ${mandat}`;

  return `Bonjour,

Je vous √©cris dans le cadre de la Journ√©e Sans Nous ‚Äì "Si on s'arr√™te, tout s'arr√™te !", organis√©e le 18 d√©cembre 2025, √† l'occasion de la Journ√©e internationale des migrant¬∑e¬∑s.

√Ä l'initiative des collectifs de personnes sans papiers, la Marche des Solidarit√©s appelle √† une gr√®ve g√©n√©rale solidaire √† l'√©chelle nationale.
üëâ L'appel complet : https://www.antiracisme-solidarite.org/18-d%C3%A9cembre-2025-journee-sans-nous

${phraseMobilisation}

Cette journ√©e d'action me permettra de m'exprimer en solidarit√© avec les personnes immigr√©es et sans papiers, qui sont mes ami¬∑es, mes voisin¬∑es et mes coll√®gues ‚Äî celles et ceux qui font tourner le pays mais restent priv√©¬∑es de droits, exploit√©¬∑es dans des conditions indignes et constamment discrimin√©¬∑es.

Aujourd'hui, les politiques racistes et inhumaines men√©es par l'√âtat (rafles, enfermements en CRA, durcissement des lois sur l'immigration, atteintes aux droits sociaux) ne sont pas seulement une attaque contre les personnes √©trang√®res : elles fragilisent tout le socle social en remettant en cause le droit du travail, en banalisant le travail dissimul√© et l'exploitation humaine, en organisant une mise en concurrence destructrice entre salari√©¬∑es, et en affaiblissant la solidarit√© collective.

Face √† cette urgence, nous avons besoin que les syndicats prennent position et ouvrent la voie √† une gr√®ve politique et solidaire.

üëâ Je vous demande :

‚Ä¢ de vous prononcer publiquement en faveur de la Journ√©e Sans Nous,
‚Ä¢ d'informer vos adh√©rent¬∑es et salari√©¬∑es sur la possibilit√© de se mobiliser le 18 d√©cembre,
‚Ä¢ et de mettre en ≈ìuvre les moyens l√©gaux pour permettre une gr√®ve solidaire (pr√©avis, communication, appui logistique‚Ä¶).

Cette journ√©e sera l'occasion de manifester, d√©battre, fermer symboliquement nos lieux de travail, pour rappeler que la solidarit√© n'a pas de papiers.

Merci pour votre √©coute et pour l'engagement que vous prendrez.
Je reste √† votre disposition pour toute information compl√©mentaire.

Solidairement,

${signature}
`;}

const MODELE_PREAVIS = "Pour la Journ√©e Sans Nous √† l'occasion de la Journ√©e internationale des Migrant.e.s 2025, nous appelons √† une journ√©e de gr√®ve pour exiger [revendication professionnelle claire, ex : r√©gularisation par le travail / fin des contr√¥les discriminatoires / protection juridique pour travailleur¬∑ses migrant¬∑es] et pour d√©noncer le racisme d'√âtat qui nie ces droits.";

/* ===== Actions message ===== */
function chargerModele(){ el('message').value=MODELE_OFFICIEL(); apercu(); updateProgress(); }
function apercu(){
  const msg=el('message').value;
  const prev=el('preview');
  if(msg){ prev.textContent=msg; prev.classList.remove('empty'); }
  else { prev.textContent="Aucun message saisi."; prev.classList.add('empty'); }
}
function copier(){
  const msg=el('message').value;
  if(!msg){ alert("Charge d'abord le mod√®le !"); return; }
  navigator.clipboard.writeText(msg).then(()=>alert('‚úÖ Message copi√© dans le presse-papiers !'));
}

/* ===== Ouvrir dans le mail (Cc robuste) ===== */
function toMailto(){
  const to = (el('destinataire').value || '').trim();
  if(!to){ alert('‚ö†Ô∏è Indique au moins un email destinataire !'); return; }

  // Normaliser la liste CC (accepte ; ou ,)
  let ccRaw = (el('cc').value || '').trim();
  ccRaw = ccRaw.replace(/[; ]+/g, ',').replace(/,+/g, ',').replace(/^,|,$/g, '');

  const sujet = el('sujet').value || 'Appel √† la mobilisation du 18 d√©cembre';
  const body  = el('message').value || MODELE_OFFICIEL();
  const enc = s => encodeURIComponent(s).replace(/%0A/g,'%0D%0A');

  const params = [];
  if (ccRaw) params.push('cc=' + encodeURIComponent(ccRaw));
  params.push('subject=' + enc(sujet));
  params.push('body=' + enc(body));

  const url = `mailto:${encodeURIComponent(to)}?` + params.join('&');
  window.location.href = url;
}

/* ===== T√©l√©charger ===== */
function telecharger(){
  const msg=el('message').value||MODELE_OFFICIEL();
  const blob=new Blob([msg],{type:'text/plain;charset=utf-8'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='mail-syndicat-journee-sans-nous.txt';
  a.click();
  URL.revokeObjectURL(a.href);
}

/* ===== Listeners & init ===== */
document.addEventListener('DOMContentLoaded',()=>{
  // Boutons
  el('btnCopier').onclick=copier;
  el('btnMailto').onclick=toMailto;
  el('btnTelecharger').onclick=telecharger;

  // Selects
  el('syndicat').onchange=()=>{ fillStructures(); };
  el('dept').onchange=()=>{ updateEmail(); };
  el('fede').onchange=()=>{ updateEmail(); };

  // Mandat toggle
  el('hasMandat').onchange=e=>{
    el('mandat-details').classList.toggle('show', e.target.checked);
    chargerModele();
  };

  // Contenu dynamique
  ['message','nom','lieu','mandat','sujet','cc','destinataire'].forEach(id=>{
    const node = el(id);
    if (node) node.addEventListener('input', ()=>{ if(id!=='message') chargerModele(); else apercu(); updateProgress(); });
  });

  loadDB();
  chargerModele();
  updateProgress();
});
</script>
</body>
</html>
